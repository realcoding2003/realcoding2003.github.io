<!DOCTYPE html>

{% assign current_lang = page.lang | default: site.default_lang %}
{% assign lang_data = site.data[current_lang] %}

<html lang="{{ current_lang }}">
<head>
    <meta charset="UTF-8">
    <script>document.documentElement.setAttribute('data-theme',localStorage.getItem('theme')||'light')</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: lang_data.site.title }} | {{ lang_data.site.title }}</title>
    <meta name="description" content="{{ page.description | default: lang_data.site.description }}">
    
    <!-- 다국어 hreflang 태그 -->
    {% if page.layout == "post" %}
      {%- assign page_lang = page.lang | default: site.default_lang -%}
      {%- assign post_slug = page.slug -%}
      {%- if page_lang == "en" -%}
        {%- assign slug_len = post_slug.size | minus: 3 -%}
        {%- assign base_slug = post_slug | truncate: slug_len, "" -%}
      {%- elsif page_lang == "ja" -%}
        {%- assign slug_len = post_slug.size | minus: 3 -%}
        {%- assign base_slug = post_slug | truncate: slug_len, "" -%}
      {%- else -%}
        {%- assign base_slug = post_slug -%}
      {%- endif -%}
      {%- assign date_path = page.date | date: "/%Y/%m/%d/" -%}
      <link rel="alternate" hreflang="ko" href="{{ site.url }}{{ date_path }}{{ base_slug }}/" />
      <link rel="alternate" hreflang="en" href="{{ site.url }}/en{{ date_path }}{{ base_slug }}-en/" />
      <link rel="alternate" hreflang="ja" href="{{ site.url }}/ja{{ date_path }}{{ base_slug }}-ja/" />
      <link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ date_path }}{{ base_slug }}/" />
    {% else %}
      {%- assign base_path = page.url | remove: '/en' | remove: '/ja' -%}
      <link rel="alternate" hreflang="ko" href="{{ site.url }}{{ base_path }}" />
      <link rel="alternate" hreflang="en" href="{{ site.url }}/en{{ base_path }}" />
      <link rel="alternate" hreflang="ja" href="{{ site.url }}/ja{{ base_path }}" />
      <link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ base_path }}" />
    {% endif %}

    <!-- 페이지네이션 noindex -->
    {% if paginator and paginator.page > 1 %}
    <meta name="robots" content="noindex, follow">
    {% endif %}
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ '/assets/favicons/favicon.ico' | relative_url }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/favicons/apple-touch-icon.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ '/assets/favicons/android-chrome-192x192.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ '/assets/favicons/android-chrome-512x512.png' | relative_url }}">
    <link rel="manifest" href="{{ '/assets/favicons/manifest.webmanifest' | relative_url }}">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    
    <!-- Highlight.js for Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css" media="(prefers-color-scheme: dark)">
    
    <!-- Theme color -->
    <meta name="theme-color" content="#0969da">
    
    <!-- Dynamic OG Image Selection -->
    {% if page.layout == "post" %}
      {% assign og_image = page.og_image | default: page.image | default: '/assets/images/og-default.jpg' %}
    {% else %}
      {% assign og_image = '/assets/images/og-default.jpg' %}
    {% endif %}
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:title" content="{{ page.title | default: lang_data.site.title }}">
    <meta property="og:description" content="{{ page.description | default: lang_data.site.description }}">
    <meta property="og:image" content="{{ og_image | absolute_url }}">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ page.url | absolute_url }}">
    <meta property="twitter:title" content="{{ page.title | default: lang_data.site.title }}">
    <meta property="twitter:description" content="{{ page.description | default: lang_data.site.description }}">
    <meta property="twitter:image" content="{{ og_image | absolute_url }}">
    
    <!-- SEO Tags -->
    {% seo %}

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "{{ lang_data.site.title }}",
        "url": "{{ site.url }}",
        "description": "{{ lang_data.site.description }}",
        "inLanguage": "{{ current_lang }}"
    }
    </script>
    
    <!-- Google Analytics -->
    {% include analytics.html %}
    
    <!-- Google AdSense -->
    <meta name="google-adsense-account" content="{{ site.adsense.client }}">
    {% include adsense.html %}
</head>

<body>
    <!-- Header -->
    {% include header.html %}
    
    <!-- Floating Side Ads -->
    {% include ad-floating.html %}

    <!-- Main Content -->
    <main class="main-content">
        {{ content }}
    </main>

    <!-- Footer -->
    {% include footer.html %}
    
    <!-- Highlight.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Highlight.js
            hljs.highlightAll();
            
            // Dark mode toggle support for highlight.js
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    setTimeout(() => {
                        hljs.highlightAll();
                    }, 100);
                });
            }
        });
    </script>

    <!-- JavaScript -->
    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
    
    <!-- Mermaid 다이어그램 지원 -->
    {% include mermaid.html %}
</body>
</html>
